--- pacemaker-Pacemaker-1.1.15/configure.ac.orig	2016-10-16 18:23:45.477084475 +0200
+++ pacemaker-Pacemaker-1.1.15/configure.ac	2016-10-16 18:28:32.400414530 +0200
@@ -655,17 +655,21 @@
 dnl ===============================================
 dnl Libraries
 dnl ===============================================
-AC_CHECK_LIB(socket, socket)			dnl -lsocket
-AC_CHECK_LIB(c, dlopen)				dnl if dlopen is in libc...
-AC_CHECK_LIB(dl, dlopen)			dnl -ldl (for Linux)
-AC_CHECK_LIB(rt, sched_getscheduler)            dnl -lrt (for Tru64)
-AC_CHECK_LIB(gnugetopt, getopt_long)		dnl -lgnugetopt ( if available )
-AC_CHECK_LIB(pam, pam_start)			dnl -lpam (if available)
+AC_SEARCH_LIBS(socket, socket)			dnl -lsocket
+AC_SEARCH_LIBS(dlopen, [dl])			dnl if dlopen is in libc... or -ldl (for Linux)
+AC_SEARCH_LIBS(sched_getscheduler, [rt])	dnl -lrt (for Tru64)
+AC_SEARCH_LIBS(getopt_long, [gnugetopt])	dnl -lgnugetopt ( if available )
+AC_CHECK_LIB(pam, pam_start, [LIBPAM=-lpam])	dnl -lpam (if available)
+AC_SUBST([LIBPAM])
 
 AC_CHECK_FUNCS([sched_setscheduler])
 
-AC_CHECK_LIB(uuid, uuid_parse)			dnl load the library if necessary
+AC_CHECK_LIB(uuid, uuid_parse, [LIBUUID=-luuid])	dnl load the library if necessary
+AC_SUBST([LIBUUID])
+oldLIBS="$LIBS"
+LIBS="$LIBS $LIBUUID"
 AC_CHECK_FUNCS(uuid_unparse)			dnl OSX ships uuid_* as standard functions
+LIBS="$oldLIBS"
 
 AC_CHECK_HEADERS(uuid/uuid.h)
 
@@ -813,8 +817,10 @@
 else
    XML2HEAD="`$XML2CONFIG --cflags`"
    AC_MSG_RESULT($XML2HEAD)
-   AC_CHECK_LIB(xml2, xmlReadMemory)
-   AC_CHECK_LIB(xslt, xsltApplyStylesheet)
+   AC_CHECK_LIB(xml2, xmlReadMemory, [AC_DEFINE([HAVE_LIBXML2], [1], [Have libxml2])  LIBXML2=-lxml2])
+   AC_CHECK_LIB(xslt, xsltApplyStylesheet, [AC_DEFINE([HAVE_LIBXSLT], [1], [Have libxslt])  LIBXSLT=-lxslt])
+   AC_SUBST([LIBXML2])
+   AC_SUBST([LIBXSLT])
 fi
 
 CPPFLAGS="$CPPFLAGS $XML2HEAD"
@@ -882,7 +888,8 @@
 dnl   bzip2
 dnl ========================================================================
 AC_CHECK_HEADERS(bzlib.h)
-AC_CHECK_LIB(bz2, BZ2_bzBuffToBuffCompress)
+AC_CHECK_LIB(bz2, BZ2_bzBuffToBuffCompress, [LIBBZ2=-lbz2])
+AC_SUBST([LIBBZ2])
 
 if test x$ac_cv_lib_bz2_BZ2_bzBuffToBuffCompress != xyes ; then
    AC_MSG_ERROR(BZ2 libraries not found)
@@ -1052,7 +1059,6 @@
 
 PKG_CHECK_MODULES(libqb, libqb >= 0.13, HAVE_libqb=1)
 CPPFLAGS="$libqb_CFLAGS $CPPFLAGS"
-LIBS="$libqb_LIBS $LIBS"
 AC_CHECK_HEADERS(qb/qbipc_common.h)
 AC_CHECK_LIB(qb, qb_ipcs_connection_auth_set)
 
@@ -1086,8 +1092,10 @@
 if test $HAVE_GLUE = 1; then
    dnl On Debian, AC_CHECK_LIBS fail if a library has any unresolved symbols
    dnl So check for all the dependencies (so they're added to LIBS) before checking for -lplumb
-   AC_CHECK_LIB(pils, PILLoadPlugin)
-   AC_CHECK_LIB(plumb, G_main_add_IPC_Channel)
+   AC_CHECK_LIB(pils, PILLoadPlugin, [LIBPILS=-lpils])
+   AC_CHECK_LIB(plumb, G_main_add_IPC_Channel, [LIBPLUMB=-lplumb])
+   AC_SUBST([LIBPILS])
+   AC_SUBST([LIBPLUMB])
 fi
 
 dnl ===============================================
@@ -1599,7 +1607,7 @@
     AC_MSG_RESULT($SUPPORT_ACL)
 
     SUPPORT_ACL=1
-    AC_CHECK_LIB(qb, qb_ipcs_connection_auth_set)
+    AC_CHECK_LIB(qb, qb_ipcs_connection_auth_set, [:])
     if test $ac_cv_lib_qb_qb_ipcs_connection_auth_set != yes; then
         SUPPORT_ACL=0
     fi
@@ -1665,8 +1673,11 @@
 	GNUTLSLIBS="`$LIBGNUTLS_CONFIG --libs`";
 	AC_MSG_RESULT($GNUTLSLIBS)
 fi
-AC_CHECK_LIB(gnutls, gnutls_init)
+AC_CHECK_LIB(gnutls, gnutls_init, [GNUTLSLIBS=-lgnutls])
+oldLIBS="$LIBS"
+LIBS="$LIBS $GNUTLSLIBS"
 AC_CHECK_FUNCS(gnutls_priority_set_direct)
+LIBS="$oldLIBS"
 
 AC_SUBST(GNUTLSHEAD)
 AC_SUBST(GNUTLSLIBS)
--- pacemaker-Pacemaker-1.1.16/pengine/Makefile.am.orig	2017-04-16 07:34:31.132737427 +0200
+++ pacemaker-Pacemaker-1.1.16/pengine/Makefile.am	2017-04-16 07:37:33.349402011 +0200
@@ -66,14 +66,14 @@
 libpengine_la_LDFLAGS	+= $(LDFLAGS_HARDENED_LIB)
 
 libpengine_la_LIBADD	= $(top_builddir)/lib/pengine/libpe_status.la \
-			$(top_builddir)/lib/cib/libcib.la
+			$(top_builddir)/lib/cib/libcib.la $(LIBXML2)
 # -L$(top_builddir)/lib/pils -lpils -export-dynamic -module -avoid-version
 libpengine_la_SOURCES	= pengine.c allocate.c notif.c utils.c constraints.c
 libpengine_la_SOURCES	+= native.c group.c clone.c master.c graph.c utilization.c
 
 pengine_CFLAGS	= $(CFLAGS_HARDENED_EXE)
 pengine_LDFLAGS	= $(LDFLAGS_HARDENED_EXE)
-pengine_LDADD	= $(top_builddir)/lib/cib/libcib.la $(COMMONLIBS)
+pengine_LDADD	= $(top_builddir)/lib/cib/libcib.la $(COMMONLIBS) $(libqb_LIBS)
 # libcib for get_object_root()
 #		$(top_builddir)/lib/hbclient/libhbclient.la
 pengine_SOURCES	= main.c
--- pacemaker-Pacemaker-1.1.16/lib/common/Makefile.am.orig	2017-04-16 07:34:31.132737427 +0200
+++ pacemaker-Pacemaker-1.1.16/lib/common/Makefile.am	2017-04-16 07:38:38.076067942 +0200
@@ -36,7 +36,7 @@
 libcrmcommon_la_CFLAGS	= $(CFLAGS_HARDENED_LIB)
 libcrmcommon_la_LDFLAGS	+= $(LDFLAGS_HARDENED_LIB)
 
-libcrmcommon_la_LIBADD	= @LIBADD_DL@ $(GNUTLSLIBS) -lm
+libcrmcommon_la_LIBADD	= @LIBADD_DL@ $(LIBPLUMB) $(GNUTLSLIBS) $(LIBXML2) $(LIBXSLT) $(libqb_LIBS) $(LIBBZ2) $(LIBUUID) -lm
 
 libcrmcommon_la_SOURCES	= compat.c digest.c ipc.c io.c procfs.c utils.c xml.c \
 			  iso8601.c remote.c mainloop.c logging.c watchdog.c \
--- pacemaker-Pacemaker-1.1.16/lib/cib/Makefile.am.orig	2017-04-16 07:34:31.132737427 +0200
+++ pacemaker-Pacemaker-1.1.16/lib/cib/Makefile.am	2017-04-16 07:39:18.802734141 +0200
@@ -30,7 +30,7 @@
 libcib_la_CFLAGS	= $(CFLAGS_HARDENED_LIB)
 libcib_la_LDFLAGS	+= $(LDFLAGS_HARDENED_LIB)
 
-libcib_la_LIBADD	= $(CRYPTOLIB) $(top_builddir)/lib/pengine/libpe_rules.la $(top_builddir)/lib/common/libcrmcommon.la
+libcib_la_LIBADD	= $(CRYPTOLIB) $(top_builddir)/lib/pengine/libpe_rules.la $(top_builddir)/lib/common/libcrmcommon.la $(GNUTLSLIBS)
 
 clean-generic:
 	rm -f *.log *.debug *.xml *~
--- pacemaker-Pacemaker-1.1.16/lib/pengine/Makefile.am.orig	2017-04-16 07:34:31.136070760 +0200
+++ pacemaker-Pacemaker-1.1.16/lib/pengine/Makefile.am	2017-04-16 07:40:06.976066925 +0200
@@ -36,7 +36,7 @@
 libpe_status_la_CFLAGS	= $(CFLAGS_HARDENED_LIB)
 libpe_status_la_LDFLAGS	+= $(LDFLAGS_HARDENED_LIB)
 
-libpe_status_la_LIBADD	= @CURSESLIBS@ $(top_builddir)/lib/common/libcrmcommon.la
+libpe_status_la_LIBADD	= @CURSESLIBS@ $(top_builddir)/lib/common/libcrmcommon.la $(LIBXML2)
 libpe_status_la_SOURCES	= status.c unpack.c utils.c complex.c native.c \
 			group.c clone.c rules.c common.c remote.c
 
--- pacemaker-Pacemaker-1.1.16/lib/fencing/Makefile.am.orig	2017-04-16 07:34:31.236070760 +0200
+++ pacemaker-Pacemaker-1.1.16/lib/fencing/Makefile.am	2017-04-16 07:42:06.086065565 +0200
@@ -25,5 +25,5 @@
 libstonithd_la_CFLAGS	= $(CFLAGS_HARDENED_LIB)
 libstonithd_la_LDFLAGS	+= $(LDFLAGS_HARDENED_LIB)
 
-libstonithd_la_LIBADD	= $(top_builddir)/lib/common/libcrmcommon.la
+libstonithd_la_LIBADD	= $(top_builddir)/lib/common/libcrmcommon.la $(LIBPILS)
 libstonithd_la_SOURCES	= st_client.c
--- pacemaker-Pacemaker-1.1.16/cib/Makefile.am.orig	2017-04-16 07:34:31.236070760 +0200
+++ pacemaker-Pacemaker-1.1.16/cib/Makefile.am	2017-04-16 07:42:50.786065054 +0200
@@ -36,7 +36,7 @@
 cib_LDFLAGS	= $(LDFLAGS_HARDENED_EXE)
 
 cib_LDADD	= $(top_builddir)/lib/cluster/libcrmcluster.la \
-		$(COMMONLIBS) $(CRYPTOLIB) $(CLUSTERLIBS)
+		$(COMMONLIBS) $(CRYPTOLIB) $(CLUSTERLIBS) $(LIBPAM)
 
 cib_SOURCES	= io.c messages.c notify.c \
 		callbacks.c main.c remote.c common.c
